<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Vocabulary Quiz</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Home Button */
        .home-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            text-decoration: none;
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .home-btn:hover {
            background-color: #0056b3;
        }

        /* Containers */
        .container {
            flex: 1;
            max-width: 800px;
            margin: 60px auto 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            width: 90%;
        }

        h1 { color: #2c3e50; margin-bottom: 20px; }
        h2 { color: #34495e; }

        /* Setup Screen */
        .setup-section {
            text-align: left;
            margin-bottom: 20px;
        }
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .topic-item {
            background: #eef2f5;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .topic-item:hover { background: #e2e6ea; }
        .topic-item input { margin-right: 10px; transform: scale(1.2); }
        
        .count-select {
            margin: 20px 0;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button.start-btn, button.replay-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        button.start-btn:hover, button.replay-btn:hover {
            background-color: #218838;
            transform: scale(1.05);
        }

        /* Game Screen */
        #game-screen { display: none; }
        .progress {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }
        .question-box {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #007bff;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }
        .option-btn {
            background: white;
            border: 2px solid #dee2e6;
            padding: 15px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: #495057;
        }
        .option-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }

        /* Result Screen */
        #result-screen { display: none; }
        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #007bff;
            margin: 20px 0;
        }
        .mistakes-list {
            text-align: left;
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .mistake-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .mistake-eng { font-weight: bold; font-size: 18px; color: #dc3545; }
        .mistake-correct { color: #28a745; margin-left: 10px; }

        /* Footer */
        footer {
            text-align: center;
            padding: 15px;
            color: #6c757d;
            font-size: 12px;
            border-top: 1px solid #e9ecef;
            background: white;
        }
    </style>
</head>
<body>

    <a href="https://game.kelegulu.com" class="home-btn">üè† Home</a>

    <div class="container" id="setup-screen">
        <h1>Science Vocabulary Challenge</h1>
        <h2>Select Topics (Form 1)</h2>
        
        <div class="setup-section">
            <div style="margin-bottom: 10px;">
                <button onclick="toggleAllTopics(true)" style="font-size:12px; padding:5px 10px;">Select All</button>
                <button onclick="toggleAllTopics(false)" style="font-size:12px; padding:5px 10px;">Clear All</button>
            </div>
            <div class="topic-grid" id="topic-container">
                </div>
        </div>

        <div class="setup-section" style="text-align: center;">
            <label for="q-count">Number of Questions:</label>
            <select id="q-count" class="count-select">
                <option value="10">10 È°å</option>
                <option value="20">20 È°å</option>
                <option value="30">30 È°å</option>
                <option value="50">50 È°å</option>
                <option value="80">80 È°å</option>
            </select>
            <br>
            <button class="start-btn" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <div class="container" id="game-screen">
        <div class="progress">Question <span id="current-q">1</span> / <span id="total-q">10</span></div>
        <div class="question-box" id="question-text">Loading...</div>
        <div class="options-grid" id="options-container">
            </div>
    </div>

    <div class="container" id="result-screen">
        <h1>Game Over!</h1>
        <div class="score-display">Score: <span id="final-score">0</span>%</div>
        <p>You got <span id="score-num">0</span> out of <span id="score-total">0</span> correct.</p>
        
        <button class="replay-btn" onclick="location.reload()">Replay ÈáçÁé©</button>

        <div id="mistakes-container" class="mistakes-list" style="display:none;">
            <h3>Review Incorrect Answers:</h3>
            <div id="mistakes-content"></div>
        </div>
    </div>

    <footer>
        Designed by KLÊÄùËÄÉÁ†îÁ©∂ÂÆ§
    </footer>

    <script>
        // Data from your Google Sheet
        const rawData = [
            {topic: "Learning about science", eng: "science", chi: "ÁßëÂ≠∏"},
            {topic: "Learning about science", eng: "scientist", chi: "ÁßëÂ≠∏ÂÆ∂"},
            {topic: "Learning about science", eng: "physics", chi: "Áâ©ÁêÜÂ≠∏"},
            {topic: "Learning about science", eng: "chemistry", chi: "ÂåñÂ≠∏"},
            {topic: "Learning about science", eng: "biology", chi: "ÁîüÁâ©Â≠∏"},
            {topic: "Practice of Science", eng: "scientific investigation", chi: "ÁßëÂ≠∏Êé¢Á©∂ÔºèÁßëÂ≠∏Á†îÁ©∂"},
            {topic: "Practice of Science", eng: "observe", chi: "ËßÄÂØü"},
            {topic: "Practice of Science", eng: "hypothesis", chi: "ÂÅáË®≠"},
            {topic: "Practice of Science", eng: "experiment", chi: "ÂØ¶È©ó"},
            {topic: "Practice of Science", eng: "measure", chi: "ÈáèÂ∫¶"},
            {topic: "Practice of Science", eng: "record", chi: "Ë®òÈåÑ"},
            {topic: "Practice of Science", eng: "analyse", chi: "ÂàÜÊûê"},
            {topic: "Practice of Science", eng: "conclusion", chi: "ÁµêË´ñ"},
            {topic: "Practice of Science", eng: "fair test", chi: "ÂÖ¨Âπ≥Ê∏¨Ë©¶"},
            {topic: "Practice of Science", eng: "factors", chi: "Âõ†Á¥†"},
            {topic: "Practice of Science", eng: "independent variable", chi: "Ëá™ËÆäÈáè"},
            {topic: "Practice of Science", eng: "controlled variables", chi: "ÊéßÂà∂ËÆäÈáè"},
            {topic: "Practice of Science", eng: "dependent variable", chi: "ÊáâËÆäÈáè"},
            {topic: "Practice of Science", eng: "classifying", chi: "ÂàÜÈ°û"},
            {topic: "Practice of Science", eng: "pattern seeking", chi: "Â∞ãÊâæÊ®°Âºè"},
            {topic: "Practice of Science", eng: "model building", chi: "Âª∫ÊßãÊ®°Âûã"},
            {topic: "Laboratory Safety", eng: "fire blanket", chi: "Èò≤ÁÅ´Ê∞à"},
            {topic: "Laboratory Safety", eng: "fire extinguisher", chi: "ÊªÖÁÅ´Á≠í"},
            {topic: "Laboratory Safety", eng: "sand bucket", chi: "Ê≤ôÊ°∂"},
            {topic: "Laboratory Safety", eng: "hazard warning symbols", chi: "Âç±Èö™Ë≠¶ÂëäÁ¨¶Ëôü"},
            {topic: "Laboratory Safety", eng: "flammable", chi: "ÊòìÁáÉÁöÑ"},
            {topic: "Laboratory Safety", eng: "explosive", chi: "ÁàÜÁÇ∏ÊÄßÁöÑ"},
            {topic: "Laboratory Safety", eng: "corrosive", chi: "ËÖêËùïÊÄßÁöÑ"},
            {topic: "Laboratory Safety", eng: "toxic", chi: "ÊúâÊØíÁöÑ"},
            {topic: "Laboratory Safety", eng: "harmful", chi: "ÊúâÂÆ≥ÁöÑ"},
            {topic: "Laboratory Safety", eng: "irritant", chi: "Âà∫ÊøÄÊÄßÁöÑ"},
            {topic: "Laboratory Safety", eng: "chemicals", chi: "ÂåñÂ≠∏ÂìÅ"},
            {topic: "Laboratory Safety", eng: "fire triangle", chi: "ÁáÉÁáí‰∏âËßí"},
            {topic: "Laboratory Safety", eng: "fuel", chi: "ÁáÉÊñô"},
            {topic: "Laboratory Safety", eng: "oxygen", chi: "Ê∞ßÊ∞£"},
            {topic: "Laboratory Safety", eng: "high temperature", chi: "È´òÊ∫´"},
            {topic: "Laboratory apparatus", eng: "apparatus", chi: "ÂÑÄÂô®ÔºèÂô®Êùê"},
            {topic: "Laboratory apparatus", eng: "beaker", chi: "ÁáíÊùØ"},
            {topic: "Laboratory apparatus", eng: "reagent bottle", chi: "Ë©¶ÂäëÁì∂"},
            {topic: "Laboratory apparatus", eng: "measuring cylinder", chi: "ÈáèÁ≠í"},
            {topic: "Laboratory apparatus", eng: "test tube", chi: "Ë©¶ÁÆ°"},
            {topic: "Laboratory apparatus", eng: "conical flask", chi: "ÈåêÂΩ¢Áì∂ÔºèÈåêÂΩ¢ÁáíÁì∂"},
            {topic: "Laboratory apparatus", eng: "dropping bottle", chi: "Êª¥Áì∂"},
            {topic: "Laboratory apparatus", eng: "watch glass", chi: "Ë°®Èù¢Áöø"},
            {topic: "Laboratory apparatus", eng: "boiling tube", chi: "Ê≤∏È®∞ÁÆ°ÔºèÂ§ßË©¶ÁÆ°"},
            {topic: "Laboratory apparatus", eng: "rubber stopper", chi: "ËÜ†Â°û"},
            {topic: "Laboratory apparatus", eng: "gas jar", chi: "ÈõÜÊ∞£Áì∂"},
            {topic: "Laboratory apparatus", eng: "evaporating dish", chi: "Ëí∏ÁôºÁöø"},
            {topic: "Laboratory apparatus", eng: "Bunsen burner", chi: "Êú¨ÁîüÁáà"},
            {topic: "Laboratory apparatus", eng: "heat-proof mat", chi: "ËÄêÁÜ±Â¢ä"},
            {topic: "Laboratory apparatus", eng: "spatula", chi: "Â∞èÂåôÔºèÂàÆÂã∫"},
            {topic: "Laboratory apparatus", eng: "filter paper", chi: "ÊøæÁ¥ô"},
            {topic: "Laboratory apparatus", eng: "stand and clamp", chi: "ÊîØÊû∂ÂíåÂ§æÈâó"},
            {topic: "Laboratory apparatus", eng: "wire gauze", chi: "Áü≥Ê£âÁ∂≤ÔºèÈáëÂ±¨Á∂≤"},
            {topic: "Laboratory apparatus", eng: "tongs", chi: "Â§æÈâóÔºèÈâóÂ≠ê"},
            {topic: "Laboratory apparatus", eng: "test tube rack", chi: "Ë©¶ÁÆ°Êû∂"},
            {topic: "Laboratory apparatus", eng: "dropper", chi: "Êª¥ÁÆ°"},
            {topic: "Laboratory apparatus", eng: "tripod", chi: "‰∏âËÖ≥Êû∂"},
            {topic: "Laboratory apparatus", eng: "test tube holder", chi: "Ë©¶ÁÆ°Â§æ"},
            {topic: "Laboratory apparatus", eng: "funnel", chi: "ÊºèÊñó"},
            {topic: "Laboratory apparatus", eng: "glass rod", chi: "ÁéªÁíÉÊ£í"},
            {topic: "Using measuring instruments", eng: "metre (m)", chi: "Á±≥ (m)"},
            {topic: "Using measuring instruments", eng: "kilometre (km)", chi: "ÂçÉÁ±≥ÔºèÂÖ¨Èáå (km)"},
            {topic: "Using measuring instruments", eng: "centimetre (cm)", chi: "ÂéòÁ±≥ (cm)"},
            {topic: "Using measuring instruments", eng: "millimetre (mm)", chi: "ÊØ´Á±≥ (mm)"},
            {topic: "Using measuring instruments", eng: "millilitre (mL)", chi: "ÊØ´Âçá (mL)"},
            {topic: "Using measuring instruments", eng: "volume", chi: "È´îÁ©ç"},
            {topic: "Using measuring instruments", eng: "cubic metre (m¬≥)", chi: "Á´ãÊñπÁ±≥ (m¬≥)"},
            {topic: "Using measuring instruments", eng: "cubic centimetre (cm¬≥)", chi: "Á´ãÊñπÂéòÁ±≥ (cm¬≥)"},
            {topic: "Using measuring instruments", eng: "litre (L)", chi: "ÂÖ¨Âçá (L)"},
            {topic: "Using measuring instruments", eng: "meniscus", chi: "Ê∂≤Èù¢ÂΩéÊúàÈù¢"},
            {topic: "Using measuring instruments", eng: "displacement can", chi: "ÊéíÊ∞¥ÈáèÁ≠íÔºèÊéíÊ∞¥ÁΩê"},
            {topic: "Using measuring instruments", eng: "balance", chi: "Â§©Âπ≥"},
            {topic: "Using measuring instruments", eng: "gram (g)", chi: "ÂÖã (g)"},
            {topic: "Using measuring instruments", eng: "mass", chi: "Ë≥™Èáè"},
            {topic: "Using measuring instruments", eng: "milligram (mg)", chi: "ÊØ´ÂÖã (mg)"},
            {topic: "Using measuring instruments", eng: "kilogram (kg)", chi: "ÂçÉÂÖãÔºèÂÖ¨Êñ§ (kg)"},
            {topic: "Using measuring instruments", eng: "re-zero (tare)", chi: "Ê≠∏Èõ∂"},
            {topic: "Using measuring instruments", eng: "degrees Celsius", chi: "ÊîùÊ∞èÂ∫¶"},
            {topic: "Using measuring instruments", eng: "thermometer", chi: "Ê∫´Â∫¶Ë®à"},
            {topic: "Using measuring instruments", eng: "temperature sensor", chi: "Ê∫´Â∫¶ÊÑüÊáâÂô®"},
            {topic: "Using measuring instruments", eng: "data-logger", chi: "Êï∏ÊìöË®òÈåÑÂô®"},
            {topic: "Using measuring instruments", eng: "stopwatch", chi: "ÁßíÈå∂"},
            {topic: "Using measuring instruments", eng: "hour", chi: "Â∞èÊôÇ"},
            {topic: "Using measuring instruments", eng: "second", chi: "Áßí"},
            {topic: "Using measuring instruments", eng: "minute (min)", chi: "ÂàÜÈêò (min)"},
            {topic: "Using measuring instruments", eng: "error", chi: "Ë™§Â∑Æ"},
            {topic: "Using measuring instruments", eng: "chimney", chi: "ÁÖôÂõ™"},
            {topic: "Using measuring instruments", eng: "rubber tubing", chi: "Ê©°ËÜ†ÂñâÁÆ°"},
            {topic: "Using measuring instruments", eng: "collar", chi: "È†∏ÂúàÔºèÁí∞"},
            {topic: "Using measuring instruments", eng: "base", chi: "Â∫ïÂ∫ß"},
            {topic: "Using measuring instruments", eng: "air hole", chi: "ÈÄ≤Ê∞£Â≠î"},
            {topic: "Using measuring instruments", eng: "luminous flame", chi: "‰∫ÆÁÑ∞ÔºèÈªÉËâ≤ÁÅ´ÁÑ∞"},
            {topic: "Using measuring instruments", eng: "non-luminous flame", chi: "Èùû‰∫ÆÁÑ∞ÔºèËóçËâ≤ÁÅ´ÁÑ∞"},
            {topic: "Using measuring instruments", eng: "strike back", chi: "ÂõûÁáÉ"},
            {topic: "The Water cycle", eng: "physical states", chi: "Áâ©ÁêÜÁãÄÊÖã"},
            {topic: "The Water cycle", eng: "solid", chi: "Âõ∫È´î"},
            {topic: "The Water cycle", eng: "liquid", chi: "Ê∂≤È´î"},
            {topic: "The Water cycle", eng: "gas", chi: "Ê∞£È´î"},
            {topic: "The Water cycle", eng: "water vapour", chi: "Ê∞¥Ëí∏Ê∞£"},
            {topic: "The Water cycle", eng: "melting", chi: "ËûçÂåñ"},
            {topic: "The Water cycle", eng: "melting point", chi: "ÁÜîÈªû"},
            {topic: "The Water cycle", eng: "freezing", chi: "ÁµêÂÜ∞ÔºèÂáùÂõ∫"},
            {topic: "The Water cycle", eng: "freezing point", chi: "ÂáùÂõ∫ÈªûÔºèÂÜ∞Èªû"},
            {topic: "The Water cycle", eng: "boiling", chi: "Ê≤∏È®∞"},
            {topic: "The Water cycle", eng: "evaporation", chi: "Ëí∏Áôº"},
            {topic: "The Water cycle", eng: "boiling point", chi: "Ê≤∏Èªû"},
            {topic: "The Water cycle", eng: "condensation", chi: "ÂáùÁµê"},
            {topic: "The Water cycle", eng: "water cycle", chi: "Ê∞¥Âæ™Áí∞"},
            {topic: "The Water cycle", eng: "steam", chi: "Ëí∏Ê±ΩÔºèÊ∞¥Ëí∏Ê∞£"},
            {topic: "The Water cycle", eng: "rate of evaporation", chi: "Ëí∏ÁôºÈÄüÁéá"},
            {topic: "Dissolving", eng: "dissolve", chi: "Ê∫∂Ëß£"},
            {topic: "Dissolving", eng: "solvent", chi: "Ê∫∂Âäë"},
            {topic: "Dissolving", eng: "solution", chi: "Ê∫∂Ê∂≤"},
            {topic: "Dissolving", eng: "solute", chi: "Ê∫∂Ë≥™"},
            {topic: "Dissolving", eng: "soluble", chi: "ÂèØÊ∫∂ÁöÑ"},
            {topic: "Dissolving", eng: "universal solvent", chi: "Ëê¨ËÉΩÊ∫∂Âäë"},
            {topic: "Dissolving", eng: "insoluble", chi: "‰∏çÊ∫∂ÁöÑ"},
            {topic: "Dissolving", eng: "rate of dissolving", chi: "Ê∫∂Ëß£ÈÄüÁéá"},
            {topic: "Dissolving", eng: "solubility", chi: "Ê∫∂Ëß£Â∫¶"},
            {topic: "Water purification", eng: "E. coli", chi: "Â§ßËÖ∏Ê°øËèå"},
            {topic: "Water purification", eng: "microorganism", chi: "ÂæÆÁîüÁâ©"},
            {topic: "Water purification", eng: "impurity", chi: "ÈõúË≥™"},
            {topic: "Water purification", eng: "alum", chi: "ÊòéÁ§¨"},
            {topic: "Water purification", eng: "water purification", chi: "Ê∑®Ê∞¥ÔºèÊ∞¥ÁöÑÊ∑®Âåñ"},
            {topic: "Water purification", eng: "Amoeba", chi: "ËÆäÂΩ¢Ëü≤"},
            {topic: "Water purification", eng: "filtration", chi: "ÈÅéÊøæ"},
            {topic: "Water purification", eng: "sediment", chi: "Ê≤âÁ©çÁâ©ÔºèÊ≤âÊæ±Áâ©"},
            {topic: "Water purification", eng: "sedimentation", chi: "Ê≤âÊæ±‰ΩúÁî®"},
            {topic: "Water purification", eng: "filtrate", chi: "ÊøæÊ∂≤"},
            {topic: "Water purification", eng: "filter column", chi: "ÊøæÊü±"},
            {topic: "Water purification", eng: "filter paper", chi: "ÊøæÁ¥ô"},
            {topic: "Water purification", eng: "distillation", chi: "Ëí∏È§æ"},
            {topic: "Water purification", eng: "distilled water", chi: "Ëí∏È§æÊ∞¥"},
            {topic: "Water purification", eng: "residue", chi: "ÊÆòÊ∏£ÔºèÂâ©È§òÁâ©"},
            {topic: "Further treatment of drinking water", eng: "chlorine", chi: "Ê∞Ø"},
            {topic: "Further treatment of drinking water", eng: "chlorination", chi: "Âä†Ê∞ØËôïÁêÜÔºèÊ∞ØÂåñ‰ΩúÁî®"},
            {topic: "Further treatment of drinking water", eng: "ozone", chi: "Ëá≠Ê∞ß"},
            {topic: "Further treatment of drinking water", eng: "ultraviolet light", chi: "Á¥´Â§ñÁ∑ö"},
            {topic: "Further treatment of drinking water", eng: "fluoride", chi: "Ê∞üÂåñÁâ©"},
            {topic: "Further treatment of drinking water", eng: "fluoridation", chi: "Âä†Ê∞üËôïÁêÜÔºèÊ∞üÂåñ‰ΩúÁî®"},
            {topic: "Water conservation and pollution", eng: "pollutant", chi: "Ê±°ÊüìÁâ©"},
            {topic: "Water conservation and pollution", eng: "water pollution", chi: "Ê∞¥Ê±°Êüì"}
        ];

        let gameQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let mistakes = [];

        // Init Topics
        const topics = [...new Set(rawData.map(item => item.topic))];
        const topicContainer = document.getElementById('topic-container');
        topics.forEach(topic => {
            const div = document.createElement('div');
            div.className = 'topic-item';
            div.innerHTML = `
                <input type="checkbox" id="${topic}" value="${topic}" checked>
                <label for="${topic}">${topic}</label>
            `;
            // Toggle checkbox when clicking the div
            div.onclick = (e) => {
                if(e.target.tagName !== 'INPUT') {
                    const cb = div.querySelector('input');
                    cb.checked = !cb.checked;
                }
            };
            topicContainer.appendChild(div);
        });

        function toggleAllTopics(checked) {
            document.querySelectorAll('#topic-container input[type="checkbox"]').forEach(cb => {
                cb.checked = checked;
            });
        }

        function startGame() {
            // Get selected topics
            const selectedTopics = Array.from(document.querySelectorAll('#topic-container input:checked'))
                                        .map(cb => cb.value);
            
            if (selectedTopics.length === 0) {
                alert("Please select at least one topic!");
                return;
            }

            // Filter data
            const pool = rawData.filter(item => selectedTopics.includes(item.topic));
            
            // Get question count
            const count = parseInt(document.getElementById('q-count').value);
            if (pool.length < count) {
                alert(`Selected topics only have ${pool.length} words. Please reduce question count or select more topics.`);
                return;
            }

            // Randomize and slice
            gameQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, count);
            
            currentIndex = 0;
            score = 0;
            mistakes = [];

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('total-q').innerText = count;
            
            loadQuestion();
        }

        function loadQuestion() {
            const q = gameQuestions[currentIndex];
            document.getElementById('current-q').innerText = currentIndex + 1;
            document.getElementById('question-text').innerText = q.eng;
            
            // Prepare options: 1 correct + 3 wrong
            const wrongOptions = rawData
                .filter(item => item.chi !== q.chi) // Ensure distinct answer
                .sort(() => 0.5 - Math.random())
                .slice(0, 3)
                .map(item => item.chi);
            
            const options = [q.chi, ...wrongOptions].sort(() => 0.5 - Math.random());
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.chi, btn);
                container.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btnElement) {
            // Disable all buttons
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            if (selected === correct) {
                btnElement.classList.add('correct');
                score++;
            } else {
                btnElement.classList.add('wrong');
                // Highlight correct one
                buttons.forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
                mistakes.push({
                    eng: gameQuestions[currentIndex].eng,
                    correct: correct,
                    wrong: selected
                });
            }

            setTimeout(() => {
                currentIndex++;
                if (currentIndex < gameQuestions.length) {
                    loadQuestion();
                } else {
                    showResult();
                }
            }, 1500);
        }

        function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            const total = gameQuestions.length;
            const percentage = Math.round((score / total) * 100);
            
            document.getElementById('final-score').innerText = percentage;
            document.getElementById('score-num').innerText = score;
            document.getElementById('score-total').innerText = total;

            if (mistakes.length > 0) {
                const list = document.getElementById('mistakes-content');
                list.innerHTML = '';
                mistakes.forEach(m => {
                    const div = document.createElement('div');
                    div.className = 'mistake-item';
                    div.innerHTML = `
                        <div class="mistake-eng">${m.eng}</div>
                        <div>Your answer: <span style="text-decoration: line-through; color: #999;">${m.wrong}</span></div>
                        <div>Correct: <span class="mistake-correct">${m.correct}</span></div>
                    `;
                    list.appendChild(div);
                });
                document.getElementById('mistakes-container').style.display = 'block';
            } else {
                document.getElementById('mistakes-container').style.display = 'none';
            }
        }
    </script>
</body>
</html>